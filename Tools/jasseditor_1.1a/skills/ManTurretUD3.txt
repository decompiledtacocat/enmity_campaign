function ManTurretUDConditions takes nothing returns boolean
return GetBooleanAnd(GetBooleanAnd(( IsUnitIllusionBJ(GetEnteringUnit()) == false ), ( IsUnitType(GetEnteringUnit(), UNIT_TYPE_HERO) == true )),( IsUnitAlly(GetEnteringUnit(), Player(6)) == true ))
endfunction
function ManTurretUDFilter  takes nothing returns boolean
return  GetBooleanAnd((GetOwningPlayer(GetFilterUnit()) == Player(PLAYER_NEUTRAL_PASSIVE) ),GetBooleanOr(( GetUnitTypeId(GetFilterUnit()) == 'h00M' ),( GetUnitTypeId(GetFilterUnit()) == 'h00L' )) )
endfunction
function ManTurretUDActions takes nothing returns nothing
       local unit pickedunit
    local unit enteringunit=GetEnteringUnit()
    local player mplayer=GetOwningPlayer(enteringunit)
    local location entered=GetUnitLoc(enteringunit)
    local location turret
    local group turretgroup
set turretgroup=GetUnitsInRangeOfLocMatching(300,entered, Condition(function ManTurretUDFilter))
set pickedunit=FirstOfGroup(turretgroup)
call DestroyGroup(turretgroup)
set turretgroup=null
if pickedunit!=null then
call SetUnitOwner(pickedunit, mplayer, true )
set turret=GetUnitLoc(pickedunit)
loop
set entered=GetUnitLoc(enteringunit)
exitwhen GetBooleanOr((DistanceBetweenPoints(turret,entered)>300),IsUnitAliveBJ(enteringunit)==false )
call TriggerSleepAction(1.0)
call RemoveLocation(entered)
endloop
call SetUnitOwner(pickedunit, Player(PLAYER_NEUTRAL_PASSIVE), true )
endif
call RemoveLocation(entered)
call RemoveLocation(turret)
set turret=null
set entered=null
set pickedunit=null
set enteringunit=null
set mplayer =null
endfunction
//===========================================================================
function InitTrig_ManTurretUD takes nothing returns nothing
    set gg_trg_ManTurretUD = CreateTrigger(  )
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire1)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire2)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire3)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire4)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire5)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire6)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire7)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire8)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire9)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire10)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire11)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire12)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire13)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire14)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire15)
    call TriggerRegisterEnterRectSimple( gg_trg_ManTurretUD , gg_rct_Spire16)
    call TriggerAddCondition( gg_trg_ManTurretUD, Condition( function ManTurretUDConditions ) )
    call TriggerAddAction( gg_trg_ManTurretUD, function ManTurretUDActions )
endfunction
