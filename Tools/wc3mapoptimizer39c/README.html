<html><head><title>Wc3 Map Optimizer Readme</title></head><body>
<style>
a{ color:#000000; text-decoration:none; }
a:hover{ color:#0000FF; text-decoration:underline; }
table{ background-color:#ffffff; border:1px solid #666666 }
</style>
<pre>****************************************
*                                      *
*  Wc3 Text File Optimizer 3.9c        *
*                                      *
****************************************</pre>

 <p><u><b>The usual 3rd party program warning:</u></b>

<pre>  THIS PROGRAM IS DISTRIBUTED "AS IS".  NO WARRANTY OF ANY KIND IS EXPRESSED
  OR IMPLIED. YOU USE AT YOUR OWN RISK. THE AUTHOR WILL NOT BE LIABLE FOR
  DATA LOSS, DAMAGES, LOSS OF PROFITS OR ANY OTHER KIND OF LOSS WHILE USING
  OR MISSUSING THIS SOFTWARE.

  NOTE: This program as EVERY SINGLE 3rd party wc3 modding program is
  AGAINST the world editor's EULA.</pre>

<br><h1>Index:</h1><ul>
<li><a href="#wht">What does it do?</a>
<li><a href="#how">How to use it?</a>
<li><a href="#mpo">Map Optimization Options:</a><ul>

    <li><a href="#rec">Options that require MPQ reconstruction:</a><ul>
	    <li><a href="#zli">ZLIB Deflate</a>
	    <li><a href="#bff">Buffer Size</a>
	    <li><a href="#atr">Mantain (attributes)</a></ul>
    <li><a href="#lss">Auxiliar ListFile</a>
    <li><a href="#lok">Look for other scripts to obfuscate</a>
    <li><a href="#str">Optimize String usage</a><ul>
       <li><a href="#sff">Remove editor suffixes</a></ul>

    <li><a href="#blp">Clean BLPs</a>
    <li>Extra Cleaning:<ul>
	    <li><a href="#slk">Clean Slks</a>
	    <li><a href="#sff">Remove editor suffixes</a>
	    <li><a href="#pro">Remove Editor Only Files</a><ul>
       		<li><a href="#csh">Remove as much WE-only data as possible</a><ul>
			<li><a href="#doo">Keep dummy war3mapunits.doo</a></ul>
       		<li><a href="#ops">Stay "Open Source"</a>
		<li><a href="#pre">Add Comment</a></ul></ul></ul>
<li><a href="#scr">Script optimization methods:</a><ul>
    <li><a href="#use">Remove Useless code</a>
    <li><a href="#abj">AntiBJ</a>
    <li><a href="#mrg">Merge Initializations</a>
    <li><a href="#cnd">Conditions</a>
    <li><a href="#oid">Order Strings to Ids</a>
    <li><a href="#num">Shortest Number Representations</a>
    <li><a href="#shr">The "Shortest variable / function names possible" method</a><ul>
          <li><a href="#cln">Make sure to clean every unused function/variable</a>
          <li><a href="#obj">Optimize BJ functions</a>
          <li><a href="#upp">Force Upper case names</a>
          <li><a href="#frc">Force Uncalled function deletion</a>
          <li><a href="#nst">Ignore Strings</a>
          <li><a href="#iut">Safe 'IsUnitType'</a></ul>
          <li><a href="#rvn">Script uses real variable value events</a></ul>

    <li><a href="#nob">I am just a guy that wants to optimize a map, which options should I use?</a></ul>
<li><a href="#nwk">What to do if the optimized map doesn't work correctly?</a>
<li><a href="#tnw">What to do if X trigger on the map doesn't work correctly in the optimized version, while it does in the original version? </a>
<li><a href="#bgr">What to do if the optimized map becomes BIGGER than original?</a>
<li><a href="#w3s">I can't upload the optimizer to certain site</a>
<li><a href="#wdg">Widgetizer</a>
<li><a href="#err">Error Messages</a>
<li><a href="#nts">Final Notes</a>
<li><a href="#cth">Credits and Special thanks</a>
<li><a href="#fut">In the future</a>
<li><a href="#leg">Legal stuff</a>
<li><a href="#his">Version history</a></ul>

 <a name="wht"></a><h3>What does it do?</h3>

   <p>Is able to optimize the strings file, the map script and/or the map mpq itself to save space. Includes plenty of Script optimization methods that can be really useful to save space, improve execution and also work as an effective anti GUI reconstructor method (GUI reconstructors are what some people call map unprotectors)

   <p>Note that this program wasn't really designed for map protection, map protection and unprotection are urban legends without any meaning, none of them exist, it has the option to remove the files used only by the world editor, but that's only to save space, it is not the author's fault that world editor isn't able to open and edit maps that warcraft III can without problems, in case you don't want to "protect" the map, don't use the Remove Useless files option or use the "Allow map preview" option.

   <p>It is true that the script optimization options included in this program, are really effective against GUI reconstructors (aka Self Proclaimed Map Unprotectors), but that isn't their main objective, their objective is to improve performance and save space, It is not the author's fault if "map unprotectors" are unable to beat them. Anyone with a basic and kind of cheap programming knowledge and plenty of time to waste, may be able to make a program that "unprotects" maps affected by the script optimization methods included, though that program doesn't exist at this moment. And it is very unlikely that a person with those talents will waste them on such a lame tool, GUI reconstructors are after all a total aberration, direct JASS is better to edit a map.

 <a name="how"></a><h3>How to use it?</h3>

<form name="dummy2" action="" method="get">Open the exe file, then click the <input type="reset" value="Open File..."> button and find your map, then use <input type="reset" value="Save Optimized as..."> to save the optimized version of the map, before doing that you can choose what extra optimization methods you'd like.</form>

   <p>I made sure the program disallows you to save your map in the same path to ensure you have a backup of the file you optimized.

 <a name="mpo"><h3>Map Optimization Options:</h3>

    <a name="rec"></a><h4>Options that require Map MPQ reconstruction:</h4>
 Using any of these options will force the optimizer to rebuild the map's mpq. Keep in mind that it means that the optimizer needs to know all the paths of the files in the map to prevent losing them. World Editor automatically adds a (listfile) to the map that points to every file in the mpq, but if you happen to have removed it you will have to use an Auxiliar Listfile (see <a href="#lss">bellow</a>).<ul>

   <a name="zli"></a><br><li><b>Zlib Deflate.-</b> will recompress the files listed in the mpq using the ZLIB deflate compression, should save some Kbytes.

   <a name="bff"></a></li><br><li><b>Buffer Size.-</b> The entire map mpq using a new buffer size, the biggest the buffer size is the more ram the game will require to decompress it and the least space the map will need, Blizzard's favorite buffer size is 4096 bytes, and the recomended one is 65536 bytes, bigger buffer sizes may work, though they might be risky but they are worth a shot none the less. At this moment I would say that the Auto detect option is the best for you, unless you want to test other values by yourself.

   <a name="atr"></a></li><br><li><b>Mantain (attributes) .-</b> The (attributes) file is a protection used by the game to know if a map's data is phisically correct contains CRC32 for each file and also a registry for file adittion times. Normally the optimizer and other tools remove this file to avoid the process to update it, but you might want to keep it to have its phisical damage detection ability, I also think that the fact that TFT maps may just not have this file is a bug and blizzard may fix this bug everytime, so you can make the optimizer add this file (takes some bytes) .

</ul>

 <a name="lss"></a><H4>Auxiliar ListFile:</h4>
     In the case your map's mpq doesn't have a correct listfile (you should know about this in that case, if you are totally clueless about what I am talking about then you probably don't have to use this option) Use this option to give the optimizer an external listfile to be able to browse the map's mpq, and more importantly, be able to rebuild the mpq without losing any file when using ZLIB deflate, Buffer Size or Mantain (attributes).

 <H4>Miscelaneous Options</h4>

   <a name="lok"></a><ul><li><b>Look for other scripts to obfuscate.-</b> Will check all of the files listed in the listfile that have the .j or .ai extensions, then will remove comments and useless spaces from them, This is useful when you have a custom blizzard.j or an ai script in your map.

   <a name="str"></a><p><li><b>Optimize String usage.-</b> This will move the strings from the WTS file into the files that use them, If you have a map with long loading time and lots of abilities / units / items and-or upgrades , this option will improve loading time a lot.

       <a name="sff"></a><p><ul><li><b>Remove editor suffixes.-</b> The playable version of your map doesn't really need the editor suffixes anyways, use this option to remove the editor suffixes from the object files and save some kilobytes. This option requires "Optimize Strings". </ul>

   <a name="blp"></a><p><li><b>Clean BLPs.-</b> JPEG based blp files often have a bunch of unnneeded 0 bytes after the JPG header, this option just browses the map for BLPs and cleans those 0 bytes (It also needs to change other zones of the blp file to make it work) This method takes like no time, and depending on the quantity of blps in your map it may decrease 3KB or 17KB (This won't affect the quality of the blps)
 </ul>

 <H4>Extra cleaning options</H4> These options are probably the ones that offer the best reduction in map space, but they have some secondary effects like making the map not open correctly or with loss of data in World Editor.

   <a name="slk"></a><p><ul><li><b>Clean SLKs.-</b> This was initially meant to save some map space, but the compression is so good that it would only save some bytes even if the SLKs' size is halved. If your map uses SLKS, (for example you widgetized it) this option will clean the slks removing the values that don't really have to be in the slks (zeros, "-", Editor-Only stuff) This seems to decrease loading time even more.

   <p><li><b>Remove editor suffixes.-</b> More info <a href="#sff">above</a>.


   <a name="pro"></a><p><li><b>Remove Editor-Only Files.-</b> Will remove all the files that are only needed by the world editor. This will save a bunch of map space.

   <a name="pre"></a><p><li><b>Add Comment .-</b>Will Replace the map's trigger data with a custom one that just has a comment with the info you write in the text boxes, this will allow you to include contact information, the url of the "open source" version / downloadable files that include your stuff, or whatever you want a guy that opens the world editor read.

    <form name="dummy0" action="" method="get">If you are the kind of person that updates its map very often, you can use the <input type="reset" value="Browse for contents"> button to load the comment contents from a text file. (The first 2 lines of the text file would be category and name).</form>

   <p>If Category or Name are blank, this will remove the wtg and wct files instead of making a new one, this is because otherwise it would corrupt the file. Which would have an effect similar to Remove Editor-Only Files but not as effective (please, it is supposed to have correct category and comment names).

    <form name="dummy1" action="" method="get">To exit the popup sub dialog use the <input type="reset" value="<< Back"> button.</form>

   <a name="csh"></a><p><li><b>Remove as much WE-only data as possible.-</b> Makes the optimizer remove even more data than 'Remove Editor-Only Files' alone, it saves ~0.1 extra kilobytes but it causes World Editor to crash when opening the map. This option and "Add comment" are incompatible, it is also incompatible with "Stay Open Source", and you can't use this option without using Remove Editor-Only Files (Don't worry, the optimizer will check or uncheck the needed stuff automatically)

   <a name="doo"></a><ul><p><li><b>Keep dummy war3mapunits.doo.-</b> This option is an addition to the previous one. Makes a dummy war3mapunits.doo file in order to prevent Wc3sear.ch's upload script to mark the file as 'Corrupted by Third party software', if you don't find it annoying or don't plan to upload to wc3search, simply don't use this option.</ul>

   <a name="ops"></a><p><li><b>Stay "Open Source".-</b> Every map is actually open source even without checking this option, but if you do not agree with that idea or want the map to be easier to edit and you are a Pro Open Source guy, you can still use Remove Editor Only files to save space and keep the map as "Open Source" by using this option: This option will not remove the imports list, and will add war3map.j and war3map.mmp to the imports list so people can check war3map.j and also edit it and reimport, so when saving the map, the map will still work correctly. This option requires the map to be a Frozen Throne version. You can't use this option without Remove Editor-Only Files, and for obvious reason it is incompatible with "Make World Editor Crash" (Don't worry, the optimizer will check or uncheck the needed stuff automatically)
</ul>

 <a name="scr"></a><h2>Script Optimization Methods</h2>
      The script optimization methods are the feature that make this program unique, they have 3 important objectives:<ol><li>Reduce map space<li>Improve Performance<li>Screw GUI reconstructors.</ol>

 <h3>Simple Map Obfuscation methods</h3>
   Each of these methods is kind of worthless alone, but you can tell a difference with 3 or 4 at the same time. In case you don't really understand what each does, It is recommended to use all of them. Unless you find problems that's the moment where toggling some is a good idea.

   <a name="use"></a><p><ul><li><b>Remove Useless code.-</b> The way world editor converts the GUI "triggers" into JASS is kind of bad, and would leave some unnecessary code like else statements just before an endif , or forces the mapper to use things like  '==true' or '!=false' which are completelly worthless, Another worthless thing is calling DoNothing (World editor makes you use this for else statements for example)

    <p>This method will make sure to clean all these garbage.

    <p>It will also remove most of these constant functions used for configuration on JASS spells like the ones I make, and replace the places where they are used with their values. This will work for every takes nothing returns XXXXX constant function.

    <p>Also shortenes code like the ones used a lot by GUI like, creating a special effect in a line then setting a variable to last created effect, this will replace both lines with a line that sets the variable to the call of the function.

    <p>To prevent problems related to the IsUnitType / boolexpr bug checking this option automatically forces wc3map optimizer to execute a function that will try to fix that kind of bug everywhere, but if after optmizing your map using this option or 'conditions' a trigger does not work well then try enabling the <a href="#iut">Safe IsUnittype option</a></p>

   <a name="abj"></a><p><li><b>Anti BJ.-</b> Will replace most of Blizzard.j functions and constants with native / number counterparts, this process has various intentions:
       <br>- It improves map speed, cause the triggers will use less calling times because of the replacement of the functions / constants (don't expect a huge improvement though)
       <br>- It saves up some space (not too much, but always helps).

    <p>NOTE: You shouldn't use this if you are using a custom blizzard.j file or you are going to obfuscate a custom blizzard.j file. (If you don't undestand this note at all, It is safe for you to use this method)

   <a name="mrg"></a><p><li><b>Merge initializations.-</b> World editor probably adds too much extra functions and loops for the initialization process, this method will simplify the tipical pre map initialization process to the fastest, shortest way, this saves some bits and loading time (Just a little of loading time).

      <p>NOTE: This function is completelly designed for maps or their scripts.

   <a name="cnd"></a><p><li><b>Conditions.-</b> World Editor Loves to create a lot of code for trigger conditions, it makes the script easier to read, but in game they are completelly worthless, this method will reconfigure the map's conditions to use the least space possible.

   <p>To prevent problems related to the IsUnitType / boolexpr bug checking this option automatically forces wc3map optimizer to execute a function that will try to fix that kind of bug everywhere, but if after optmizing your map using this option or 'conditions' a trigger does not work well then try enabling the <a href="#iut">Safe IsUnittype option</a></p>


   <a name="oid"></a><p><li><b>Order Strings To Ids.-</b> Warcraft III has 2 ways of using orders: orderstrings and orderids , basically orderstrings are the ones you use often to issue or detect orders (ie: "frostnova" ) but orderids are integer values that represent each order directly. When you use an order string, warcraft iii checks an internal table looking for the orderid that is represented by the order string, losing some execution time. This method will just replace every direct usage of Orderstrings with usage of the OrderIds they represent, this shall save some space and improve efficiency.

 <a name="num"></a><p><li><b>Shortest Number Representations.-</b> GUI and most people sometime don't use the shortest number to represent a number ( For example we use to type 4.500 when 4.5 just works) There are many other cases like sometimes big integers may be represented in other ways like hex or "rawcode" ('RAWC') , so this will just make sure the script uses the shortest representations of the numbers (The number itself won't change). Saves some bytes and loading time (A little)


 </ul>

 <a name="shr"></a><h3>The "Shortest variable / function names possible" method</h3>

     <p>This option replaces the function and variable names in the map with the shortest values possible, this method was my goal since the day Grater found out that the length of names in JASS has an influence in map speed, it also cuts some important kilobytes depending on the size of your map script. WARNING: As a secondary effect makes the map's script much more difficult to understand or change.

     <p>Extprotect and Heavylocker had an option like this, but this program's version also takes care of strings, many JASS systems like my caster system, my templates system, InVx, AIAndy's classes system, and a lot more, use ExecuteFunc , a function that takes a function's name (in string format) as argument to execute it in another thread. When you use Extprotect or heavylocker on a map with any of those systems the map would crash, that doesn't happen with the Map Optimizer's one.

     <p>As a bonus, it will try to remove unused global variables and functions, it would only remove functions if they take arguments though to prevent issues with ExecuteFunc, you can check certain option to make it clean every unused function, but I don't recommend to do that unless you are sure you don't have any ExecuteFunc based system on your map.

     <p>This method needs to first parse common.j and blizzard.j before doing anything, if you are willing to use this program to optimize your custom blizzard.j , just give it an empty file for blizzard.j.

 <p>To determine which common.j and blizzard.j files to use you have two choices:
  <br>- Use warcraft's folder war3patch.mpq : will extract them from war3patch.mpq when needed.
  <br>- Determine the location of the j files directly.

 <p>Most likelly if you don't know which option to use there, you should use the war3patch.mpq one.

 <p>So before using this method, you have to choose the location of those files, if everything goes allright, the program will automatically ask you for them when you activate the option, in case it doesn't, or you already gave the program the locations and wish to change them, you should click that "common.j / blizzard.j location ..." button.

 <h4>Notes:</h4>

 <ul><li>This method also removes the declaration of unused global variables.

 <li>FOR JASS USERS ONLY: The program will change the contents of ANY STRING that has as content the exact name (case sensitive) of a declared real global variable or a function that takes nothing . So there is a RARE chance to have issues with:
   <ul><li>Order strings
   <li>Text messages/ multiboard values / leaderboard values / dialogs text, or whatever that appears in the screen of the map.</ul>

   <p>Because of this you should give the map a complete test after using this program, and look for weird issues, a weird text message or something bugged with order triggers may happen.

   <p>In order to avoid this issue, you can simply avoid giving function or real globals names that match the ones you use for messages or to match an order string.

 <p>If you use gui, you shouldn't really have problem with this.

 <li>It won't change the name of a function that is not called anywhere in the map and takes no arguments, this is to prevent issues with ExecuteFunc being used with concatenating and that stuff, If the function isn't called by any function and it does take arguments, the function will be deleted.

 <li>Not guaranteed to work 100% right. Please test your map after using this method on it.

 <p>Although I already tested it on my map which has a lot of variables and functions, and is also intensivelly based in ExecuteFunc systems. My map seemed to work perfectly.
</ul>
 <h4>Extra options for the "shortest names" script optimization method</h4>

 Another important thing about this method is that it has a couple of extra features that you can select:

 <a name="cln"></a><ul><p><li><b>Make sure to clean every unused function/variable.-</b> The method already cleans unused globals and functions that have arguments, But let's say it deleted a function that was also the only function that called another function / used a global variable, the other function/variable should be deleted too, this option will make the optimizer repeat the process until there is no function/variable to clean.

 <a name="obj"></a><p><li><b>Optimize BJ functions.-</b> Many functions from blizzard.j are worthless, and the point of AntiBJ is getting rid of them, BUT there are BJ functions that are useful (Like the Game-time wait). This method will optimize some of them (aka will add new versions of those functions to the map and make the map use them instead). For example my version of the "Get Units of type" function is much faster than blizzard's, and some of those BJ functions have memory leaks (Like the Game-time wait or the multiboard items functions) so my versions included don't have those leaks (THIS WON'T FIX OBJECT MEMORY LEAKS, just local variable memory leaks in those functions)</ul>

<p>NOTE: DON'T use next 2 OPTIONS unless you are SURE that you don't  have functions in your map called by a combination of ExecuteFunc and concatenation or something weird.

 <a name="upp"></a><ul><p><li><b>Force upper case names.-</b> As default the program has a big charmap with lower case and upper case characters to create the new function names, with this function you force the program to only use upper case characters, this option may reduce the Script size reduction cause the charmap has more limitations. But was designed because there is a rare case where JASS is not case sensitive.

 <p>You should only use this in case the map doesn't work after using the shortest variable names possible method, and you use the trick to use local variables in gui (you create a local variable with the same name as a global variable), in that rare case try checking this checking this option, the problem might get fixed. Otherwise you shouldn't use this option because it reduces the compression rate.

 <a name="frc"></a><p><li><b>Force uncalled function deletion.-</b> As default the program will just avoid changing the names of functions that are not called anywhere in the map and don't take arguments, to avoid probable crashes with ExecuteFunc based systems that use concatenations or other ways to call the functions. But if you are sure that you don't use any ExecuteFunc based system in your map, you can check this option so the method removes those functions and the map saves some space (this is only valid for functions that don't take arguments, unused functions that don't take arguments are always removed no matter this option is checked or not)

 <a name="nst"></a><li><b>Ignore strings.-</b> If you have an issue with an order or with a text message and you DON'T use ExecuteFunc in
your map, you can check this option to prevent the problems.
</ul>
 <a name="nob"></a><h3>I am just a guy that wants to optimize a map, which options should I use?</h3>

    <p>When you are optimizing a map it is recommended to use every obfuscation option excepting the ones marked with "not recommended".

 <a name="iut"></a><ul><p><li><b>Safe IsUnitType.-</b> This option is present to make the optimizer add a bullet proof method to avoid bugs related to the IsUnitType/Boolexpr bug, if you have problems of some triggers not working correctly after using the "Conditions" or "Remove useless code" methods try this option out, otherwise avoid to check it (hits performance a little by adding an extra function that acts as a proxy).

 <a name="rvn"></a><ul><p><li><b>Script uses real variable value events.-</b> This option is only required if you use the event 'value of real variable'. Otherwise leave it disabled cause it might cause potential troubles depending of the naems you give to real variables, if they conflict with other strings used .
 

 <a name="nwk"></a><h2>What to do if the optimized map doesn't work correctly?</h2>

 <p>Whenever you find a problem, please report them to <a href=mailto:Vexorian@gmail.com>Vexorian@gmail.com</a> , I may also want you to send me your original map script  or in the case the problem is caused by the Map optimizing options, your original map. Don't worry, I am not interested in "stealing" your map, and even If I was, I am the kind of person that doesn't need the original version of your map to do so; But I really need the original version of your map/map script to find the reasons behind the bugs SO I CAN FIX THEM.

 <p>Is the map a widgetized map? In that case try optimizing a non-widgetized version and check if it still has the bugs, In that case, remember to tell me that the bugs happen only on the widgetized version, and try unchecking "optimize strings" and see if that makes it work correctly.

<p>I suggest these debugging steps:

 <p>1) Try Optimizing the map without using any extra map script obfuscation. If the new map works, then the problem was caused by one of the obfuscation methods. In that case, Try with different combinations of obfuscation options, I recomend trying with all the obfuscation methods enabled excepting the last three which have the most chances of malfunctioning, the merge and anti bj methods are often enough. Now that we know it was caused by the obfuscation methods, I will really appreciate if you send me your map's map script file (I only need the map script).

 <p>2) In case it doesn't work even without the extra obfuscation methods, try disabling all of the extra map optimization methods, in case the map works now report it to me, and If possible send me your map so I can debug this program.

 <p>If you are using the 'Shortest variable/function names' method and you use the 'trick' to allow local variables in GUI then try enabling 'Force uppercase names'
 
 <p><a name="tnw"></a><h2>What to do if X trigger on the map doesn't work correctly in the optimized version, while it does in the original version?</h2>

   <p>This is surelly caused by one of the obfuscation methods, in this case, I will really appreciate if you send me your map's script, and you tell me which is the trigger that malfunctions.

   <p>The obfuscation methods that have more chances to cause this are 'AntiBJ' and 'Conditions' .

   <p>If you are using any of the Not recommended methods then try unchecking them.
   <p>If you are using the 'Remove useless code' or 'Conditions' methods then try enabling 'Safe IsUnitType'
   <p>If you are using the 'Shortest variable/function names' method then try enabling 'Force uppercase names'
   
 <a name="bgr"></a><h2>What to do if the optimized map becomes BIGGER than original?</h2>

   <p>Map size increasement, might be caused by various reasons:

 <p>- WAVE sound files in the map, the optimizer's features compress them wrongly. I decided to do not fix this because WAVE sounds should be removed from the surface of earth and replaced by MP3, get LAME or another sound compressor to replace your WAVE sounds to the mp3 format. If you were replacing sounds in the game with other sounds and can't have .mp3 as extension of them, don't worry, it is safe to import mp3 files as wav files, the game is able to recognize them.

 <p>- A bug in the obfuscation methods, I've never seen this, but in theory a bug in any of the obfuscation methods may cause the script to increase on size a lot, this is really unprobable though, just try the map without any extra obfuscation method, and see if the map's size is reducing now. In case you find it is caused by the obfuscation methods, please send Vexorian at wc3campaigns your map's script, I will really appreciate it,

 <p>- The only option that you used was "Keep (Attributes)" , that's supposed to support the other options, using it alone is just a bad idea.

 <a name="w3s"></a><h2>I can't upload the optimizer to certain site</h2>
 <p> If the map can be used correctly by warcraft III but can't be uploaded to a site, then it is a bug of that site and it is up to its admins to fix their upload scripts.</p>
 
 
 <a name="wdg"></a><h2>Widgetizer</h2>

    <p><a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">Widgetizer</a> is a tool by Pitzermike that basically converts the object data into slks and txts , this greatly improves loading time, but it also reduces the chances to get a better compression.

    <p>When you use a map on <a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">widgetizer</a>, it will actually reduce its size most of the times, but this is actually because <a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">widgetizer</a> already uses the buffer size feature.

    <p>Using the optimizer on a widgetized map, will reduce the map's size but not as much as it would reduce the size on a non widgetized map, just take that in mind.

    <p>Also the 'Optimize Strings' will have no effect on a widgetized map, since <a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">widgetizer</a> converts them to slks, and it already inlines the strings. But Remove Editor Suffixes will work.

    <p>There might be problems with the final result when optimizing a widgetized map, in that case try unchecking "Optimize Strings", if it doesn't work I would need you to send me your original version of the map.

    <p>There is also a Widgetizer problem caused by blizzard, the destructables become boxes some times, just uncheck [x] Destructables and [x] doodads when using widgetizer on a map, that should fix the problem.

    <p>Another optimizer option that may cause problems with widgetizer maps is the clean slks options, in case you have troubles try unchecking it.

    <p>Either way please send me the original version of your map so I can fix the bugs.

  <p><u><b>Some tests<p></u></b>

     <p>This information may help you decide what combination is better for you:

  <p>Tested Map : Vexorian Hero Arena 0.507 (not released yet)

<br><br><right><table border="1">
<tr><td></td><td><b>Map Size </b></td><td><b>Loading Time </b></td></tr>
<tr><td>Original File</td><td><p align="right">1227 KB</p></td><td>2 min 32.45 sec</td></tr>
<tr><td>Map Optimizer</td><td><p align="right">655 KB</p></td><td>2 min 17.24 sec</td></tr>
<tr><td><a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">Widgetizer</a></td><td><p align="right">1142 KB</p></td><td>1 min 13.68 sec</td></tr>
<tr><td><a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">Widgetizer</a>+Optimizer </td><td><p align="right">888 KB</p></td><td>1 min 11.25 sec</td></tr></table></right>

     <p>Granted <a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">Widgetizer</a> and Optimizer make a great synergy with a 339KB reduction and 81.2 less loading time seconds.

     <p>One thing to note is the 233KB difference between the combined <a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">Widgetizer</a> and Optimizer and the Optimizer alone, and the 1 minute 5 seconds difference in loading time. What is more important Map Size or loading time? If the map is for LAN or Single player, then you should just focus on loading time, but if the map is for bnet you should reconsider, since Bigger map size means bigger download time, certain maps may grow bigger than others depending on their object data, so you have to double check if the extra size isn't causing a download time increment bigger than the loading time reduction.

     <p>Optimizer seems to decrease loading time a little after <a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">Widgetizer</a>, but consider that the difference (2 seconds) is not meaningful and that it is in the Error range of the test. I used an external timer for that  and because of lack of time I only did one test per version of the map. It should have sense that Map optimizer decreases loading time though, because of the Script optimizations.

     <p>The loading time of my map seems to be big after both optimizations, it is because those optimizations are based on object data (both the strings optimization from the Optimizer and what the <a href="http://www.wc3campaigns.net/thread_view.php?t=73504" target="_blank">Widgetizer</a> does) , my map has thousands of lines at map initialization to declare values of spell templates, horadric cube recipes and other stuff.

 <a name="err"></a><h2>Error Messages:</h2>

 <br>- I/O Exception, unable to open file, and similars, The file you want to replace is currently opened by another program, or your disk is damaged.

 <br>- Too Much lines on file : Certain obfuscation methods have a limit of JASS lines in the file, the actual value is 30000 lines, I don't think a map script with more lines than 30000 will ever appear, but in case your map script has more than 30000 lines, tell me so I can increase the value (thus making the program use more memory)

 <br>- Merge Error: Function to merge never ends! : the map script, either because of the original file or may be the obfuscation methods made before, doesn't have its correspondant endfunction, If you are using a map script this shouldn't happen, in that case I'll ask you to send me your map script (just the script not the map) , to see what is happening.

 <br>- Other error messages: Please report them.

 <a name="nts"></a><h2>Final Notes:</h2>

 - You can associate map, and map script files with this program now, in case you want to associate string files with it too use the -wts argument before the %1

 <br>- This is not a 'map protection' program, besides the fact that map protection and map unprotection are myths,  This is a program which main objective is Map Optimizing and beating GUI reconstructors which are an awful aberration.

 <br>- The program used to come with the source code, but not anymore, the reason is that I got tired to keep sorting out the source code files into rar files, it is kind of an annoyance after so many versions. And I don't think anybody actually found the code useful at all. IF you'd like source code request it by email.

 <a name="cth"></a><h2>Credits and special thanks</h2>

 <p>Program Author: Vexorian (Víctor Hugo Solíz Kúncar)<br>
 Uses the wonderful SFMPQ.DLL Library by ShadowFlare

 <p>Special thanks to:
 <br>- Pitzermike and StarcraftFreak for the huge help they gave me about mpq manipulation.
 <br>- BlackDick for helping so much.
 <br>- AIAndy for keeping updating pjass which helps testing and finding bugs with the obfuscation methods.
 <br>- Zoar for telling me about the fact that blizzard uses UTF8
 <br>- PantoCrator, eScpy, Tyler Blank, ArcanisteR, Karukef, Archael, ShadowWolf, IceFrog, ShofetHaolam, Gotenkz, Hexenlord, Sud, adjack and many more for helping me find and fix bugs.
 <br>- BlackDick (again), DJBnJack, PitzerMike (again), StonedStoopid, Ziutek and most specially Zepir for the War3 file specifications document.

 <p>The Ultimate Packer for eXecutables :<br><center>Copyright (c) 1996-2002 Markus Oberhumer & Laszlo Molnar<br><a href="http://upx.sourceforge.net" target="_blank">http://upx.sourceforge.net</a></center>

 <a name="fut"></a><h2>In the future :</h2>
   <br>- More Obfuscation methods will keep getting released.
   <br>- Make Anti BJ also replace the functions that just swap the arguments' positions for functions that have 3 arguments, and for function return values.
   <br>- Add an option to change the quality of the minimap image.
   <br>- Options for campaign file optimizing will be added.

 <a name="leg"></a><h2>Legal stuff</h2>

    <p>I found out that you can copyright maps and files inside maps according to the EULA so some stuff about using this optimizer and licensed stuff:

 <p>- I, vexorian grant any ownership of files modiffied by the optimizer like maps, their slks and their scripts to the original authors of them. In other words you can copyright stuff optimized by the optimizer, as long as it wasn't copyrighted before, in that case it is still the original owner's property as long as it doesn't have any modiffication clause, in that case using map optimizer is not allowed.

 <p><h2>Version History</h2>

<a name="his"></a><pre>
 3.9c :
 - Fixed a bug with Anti BJ that replaced GetAbilityEffectBJ and GetAbilitySoundBJ incorrectly.
 - Fixed a bug with remove useless code that had a chance to cause bugs if a typical gamecache
   init function was called without using it as an expression but with the call statement
 - Removed some '}' debug messages.
 - Fixed a graphical glitch.
 
 3.9b :
 - Fixed a bug with Safe IsUnitType not working correctly sometimes and making the map fail.
 - Fixed a bug with 'Remove editor suffixes' it had a chance to make an ability malfunction If its only modified field was
   the editor suffix
 - Improved the 3.9 feature of optimizing gamecache functions a little.
 - Checked state of 'Not recommended' options will no longer get loaded.
 - It will always save a script file with the same name as the target map but will end with .j that will
   show the resulting script used by the map. This will save some time to the guys that like to check the
   resulting script file after optimizing.
 - 'Remove useless code' now removes some dummy order commands generated by the world editor in the preplaced
   unit creation area

 3.9 :
 - Fixed a bug when strings with a \ followed by a " were present
 - Fixed various grave bugs with Shortest Number representations and Shorter variable names possible concerning ' notation.
 - "Make sure to clean every unused function/variable" Is now way faster than before.
 - "Shortest variable/function names possible" Will no longer automatically consider names of real variables as possible
   identifier names to be used as strings. To make it consider real variables for strings,  a new option called 
   "Script uses real variable value events" has been added·
 - Fixed a chance the optimizer had to not add one file to the new map under certain circunstances.
 - 'Remove useless code' now also optimizes gamecache based systems that use an extra function to automatically setup
   their gamecache variables.
 
 
 3.8b:
 - Fixed a bug with optimizer not being aware that functions might have extra spaces before their argument lists, and this
   caused a probability for map optimizer to fail.
 - Added a Safe IsUnitType option to let it fix IsUnitType bugs even i the most extreme cases (but it hits performance
   a little I advice against using it unless there are problems.

 3.8 :
 - Fixed a bug that was making the optimizer create 2 files: c:\i.mpq and c:\h.mpq for no reason at all. The
   contents of those files were the original and optimized versions of the map.
 - Fixed a bug with 'Remove Useless Code' that made maps fail when optimized when they had and else before
   an endif just before a line that uses a constant function that didn't take arguments.
 - AntiBJ now changes GetUnitAbilityLevelSwapped to GetUnitAbilityLevel as it was supposed to do.
 - The result map / script now uses 1 character to break lines instead of 2. This saves a pair of kilobytes in maps with big map
   scripts.


 3.7 :
 - Fixed a bug with Merge initializations that could move to the global declaration a value that wasn't
   declared yet and cause script errors.
 - Fixed a bug with the selection of script files that choose commonj twice instead of considering blizzard.j
   which makes me wonder if anybody actually used that option.
 - It is finallly possible to use an auxiliar listfile to help the optimizer browse the map's file.
 - Added an option that allows you to update/create the (attributes) file.
 - An inescrupolous party has been calling the "Make world editor Crash" option a "Map protection", and were
   making "gosu 1337" map unprotection tutorials to get rid of that "Protection" so I just changed the name
   of that option to "Remove As much WE-only data as possible" with a warning that it will cause World Editor
   to crash when openning the map file.
 - Added a "Keep dummy war3mapunits.doo" option that allows the optimizer to keep a dummy war3mapunits.doo
   in the map when using "Remove As much WE-only data as possible" , this is to prevent wc3sear.ch's map
   upload script to mark the map as 'Corrupted by a Third party software'.
 - Various interface changes.
 - Improved the formatting of the readme.html file



 3.6 :
 - "Merge Initialization" , now saves even more script size and its merge globals process got a speed boost.
 - "Optimize BJ functions" now also fixes a leak on GetCurrentCameraSetup and Adds a faster version of
   PolarProjectionBJ.
 - "Clean slks" no longer removes the special classification of units, cause it is actually considered by
   the "Random Creep Unit Type" function.
 - Added "Force Upper Case" option to "shortest variable/function names possible" it should be used to fix
   a very rare bug that may happen in some maps when using that method.

 3.5b:
 - Fixed a chance to LOSE the script file of the map when optimizing widgetized maps, this seems to have
   been caused by a SFMPQ.DLL bug with listfiles when you make plenty of modiffications, or something like
   that.
 - Nothing else besides some minor updates on the readme, Download this version only if you had problems with
   widgetized maps, It might not solve every single problem with widgetized maps, but at least it fixed the
   ones presented in 2 maps I got. More minor updates might be released in the near future until I am sure
   every single bug with widgetizer is fixed.

 3.5:
 - Added 'Keep "Open Source"'  option for Remove Editor Only Files.
 - Fixed a bug with "Remove Editor Only Files" making the optimizer freeze and create a big map file when
   being used on ROC files , special thanks to ShofetHaolam for reporting it. I forgot ROC maps when testing
   this feature, sorry.
 - You can now open the readme file from the about dialog.
 - Fixed a bug with "Merge Initializations" not merging functions that were empty.
 - "Shortest Number Representations" no longer requires you to use "Shortest Variable/function names possible"
   and is also used by "Look for other files to obfuscate"

 3.4b :
 - Fixed a deadly bug: Remove "World Editor only files" was removing some data required in multiplayer!
 - html readme

 3.4 :
 - Fixed a tricky bug that had a chance to appear when using 'Conditions' or 'Remove useless code' , the bug
   was actually blizzard's fault and was really tricky.
 - Fixed bugs with clean BLPs option.
 - Fixed 'Remove Editor only files' not removing the listfile when Buffer size or zlib weren't used.
 - 'Remove Editor only files' now removes the WE data fro item/unit tables, forces, upgrades and ability
   availability.
 - Changed the way 'Make world editor crash' works, it no longers turns the map into an infinite loop but it
   adds less space.

 3.3 :
 - Added clean BLPs option.
 - Script optimization removes a lot of more useless spaces than before.
 - Fixed a bug with Remove Editor Suffixes, in some rare situations it could disable an ability. It was
   actually blizzard's fault and seems to be caused by a change in patch 1.18.
 - Fixed various bugs with the "Conditions" method.
 - Improved "Conditions" method now avoids to add unnecesary parenthesis/spaces.
 - Fixed a logic flaw that was making the "Shortest names possible" work only if the "Make sure to clean
   every unused function" method is checked. And it stopped the map from working if you checked the
   Optimize BJ functions method.
 - Merged the "Merge" obfuscation methods (Merge initialization functions, merge global initializations and
   merge arrays init) into one method called "Merge initializations".
 - Fixed a bug wit the "Shortest names possible" method combined with functions that had local variable names
   that started with array, causing map corruption (This is the kind of bug you would only note when optimizing a WEU map)
 - Fixed a bug that was disabling the optimizer to fix a map correctly if it didn't have a war3map.wts (Mostly
   the case of a special kind of widgetized map)

 - By popular demand added "Make World Editor Crash" option.

 3.2 :
 - New Script Obfuscation Method : "Shortest Number Representations"
 - Fixed a bug with the "Optimize BJ Functions" method that was literally crippling the purpose of the
    enter/leave rect(region) registration functions.
 - Optimize BJ Functions optimizes the CountLivingPlayerUnitsOfTypeId function to a really improved
   version of it.
 - "Merge initialization functions" now also merges InitTechTree and InitUpgrades.
 - Remove useless code also removes !=false

 3.1 :
 - New Script Optimization Method: "Optimize BJ Functions"

 - Fixed Merge Globals obfuscation method, now it avoids merging values that shouldn't be merged (like bj
   variables that were not initialized)
 - "Remove useless files" and "Remove unit position data were merged" into Remove Editor-Only Files.


 3.0b :
 - Fixed the damned crash

 3.0 :
 - Fixed a lame bug with map scripts that had strings that were x and some number (for example "x3")
 - Fixed a bug with Clean SLKs when reading SLKs that were made using Microsoft Excel.
 - Fixed a bug when optimizing strings and certain interface error messages.

 2.9 :
 - Fixed a bug with the script loader and AntiBJ combined that sometimes stopped the map from working.
 - Fixed a bug with AntiBJ actually stopping the Set Unit Ability level function for GUI from working at all.
 - String Optimizing / Remove editor suffixes should work for object strings files too.
 - New Script optimizing method: Option to make sure to clean every unused function/variable.
 - New Map optimizing option: SLK cleaning.
 - Fixed some typos in this file.

 2.8 :
 - Works on Widgetized maps without halting now.
 - Fixed bugs with scripts that had \\ at the end of strings.
 - Conditions obfuscation method is faster.
 - No longer loads the map script again when using the 'shortest' obfuscation method
 - Fixed a bug that was reducing compression ratio a lot and was kind of lame, the script file was getting duplicated? , and even worse the duplicated was the unobfuscated version.

 2.7 :
 - Fixed major bugs with maps that had scripts that used /" inside strings.
 - Fixed a bug with shortest variable/function names possible combined with conditions obfuscation
 - Will now consider the strings used on war3map.wtg and war3map.wct in case protection and map preview are unchecked.

 2.6 :
 - New map optimization option that allows to move the strings from the wts file into the files that use them, this is effective for reducing loading time and also allows you to remove the editor suffixes to save some extra kilobytes.
 - Rebuildin the map with new buffer size or making Zlib compression should be much faster now.
 - Simple string file optimization is much faster.
 - Fixed a bug when copying the map, was copying the map twice, so it halved the time used for that.

 2.5 :
 - New important obfuscation method that replaces the names of variables/ functions in the map with really small names, this makes the map smaller and much faster.
 - Fixed a small bug, maps would generally lose some extra bytes now.

 2.4 :
 - AntiBJ and remove useless code now optimize patch 1.18 stuff.
 - Compatibility with other languages, again.
 - Now uses the right places to save options and temporal files (Would fix problems with user restrictions and that stuff in some windows versions)

 2.3 :
 - Fixed a horrible bug that would cause total corruption when you had a comment with a " inside in your map.
 - Fixed a with codifications that inserted '?' signs at the start of the maps.
 - Fixed a bug with 'AntiBJ' not working in certain situations
 - Fixed a bug with 'Merge array initializations' not working in certain situations

 - It will tell you how much bytes it saved besides of the percentage now.

 2.2 :
 - Fixed a horrible bug that happened when a string finished with a carriage return in the JASS script, making the program to 'eat' some of the remaining code.
 - There was a chance of odd I/O errors on certain maps, that was fixed.
 - Fixed a bug with the merge array initializations method.
 - Hopefully now works 100% allright with maps that use 'Foreign' characters. The only way to test this I had was the Ñ I had from spanish, but it should work with the other languages.

 - Added AUTODETECT to the buffer size level option, and fixed a bug with it, (it wasn't actually using the values you wanted).
 - Merged the Constant function purge method with the remove useless code method.
 - The Remove Useless code method will also merge variable sets with function calls.
 - AntiBJ now deals with calls to BJ swapped functions.
 - The merge array initializations method is now incredibly fast, so fast that in most of the cases you don't even note the moment it is called.

 2.1 :
 - Fixed an evil bug with the purge constant functions method that was making any map unplayable
 - Fixed an evil bug, yet not that important that was happening with Big script files.

 2.0 :
 - My logic was flawed, again, figured that a function that has a return statement shouldn't be merged, fixed that now.
 - Another Flawed logic issue, it can't just add a -1 to the arguments because it would screw becase * has priority in the evaluation order, if you were having problems in certain triggers and you love using Convert Player to index and the convert index to player, then the cause of that issue was fixed.
 - Fixed another bug with AntiBJ, there was a slight chance that it wouldn't change certain functions.
 - Fixed another problem, the merge array initializations method wasn't actually working if the merge functions option was enabled, now its fixed.

 - Added the Purge constant functions method.

 1.9 :
 - My logic was flawed, I found a big problem with the way I was merging functions with locals, now the initial value of the local variable would be set in the right place (putting it in the declaration would cause problems in certain situations)
 - Fixed a rather small frozen time before starting the global merge method.
 - The merge initialization functions method got a major speed boost.
 - Other methods excepting the Merge Array Initializations and the conditions obfuscation were improved speed wise too.

 1.8 :
 - Fixed a bug that was causing the merge Initialization functions option to make the map unplayable under certain circunstances.
 - Fixed various bugs in the merge Initialization functions options when strings had carriage returns.
 - The "merge global initializations with declarations" options got a major speed boost, used to be the slowest method and now is the fastest, similar improvements will be done with the other methods.
 - Fixed some stuff in the readme file (this file)

 1.7 :
 - The function merge methods now are able to merge functions that use local variables, excepting some weird cases.
 - The function merging methods were all merged into one option, this is because they all use the same function afterall, so if one is bugged all the other ones will too, and it will save you 2 clicking times.
 - More functions are merged, at this time it will end with a gigantic main function that contains everything from global initializations to triggers, including unit creation.
 - Maps that use the Remove weather effect action, can now use Anti BJ without problems, in other words I fixed the bug with Anti BJ.

 1.6 :
 - Fixed a bug with the conditions obfuscation method, thanks Karukef for the feedback that helped finding it.
 - Fixed problems with "foreign" characters , thanks a lot to Zoar for this.
 - Reorganized the form so the status label has more space to show information.
 - Hopefully no longer leaves any temp file.

 1.5 :
 - Now you can open map files directly, and the program will automatically fix the strings and obfuscate the script of the map.
 - Also added some map optimization options like changing the buffer size, forcing zlib deflate, and removing useless files, you can get really incredibly file size compression now.
 - The Interface was changed somehow now that it can open maps too.
 - Now the program is called wc3 map optimizer.
 - Script and Wts file fixing without changing the map are still possible when you open that kind of files.
 - Global initialization merge was fixed due to a lot of glitches that certain types cause, even if the map compiled well, now it would only merge certain types or any variable that is initialized with null.
 - Global initialization merge also works with sounds now.
 - Updated AntiBJ, does its work with more functions, and the new BJ dummies that came with 1.17
 - Added The Conditions Obfuscation Method.
 - You can now associate script files or maps with this program.
 - Temporal files are now created on the same directory of this program.

 1.1 :
 - Added the "Merge Global Declarations with initializations" obfuscation method.
 - Added the "Merge Array Initializations" obfuscation method.
 - Added the "Remove useless code" optimization method.

 - Added a check/uncheck all check box, since the options are already too many.

 0.9 :
 - JASS script obfuscating no longer ignores tabs.
 - Added 3 new obfuscation methods based in merging the initialization functions into a giant one.
 - Array brackets are now considered operators as they are supposed to be, so the problem with stuff inside array brackets not being fixed is solved.
 - Fixed a bug in the Anti BJ, was causing it to fix strings instead of non strings after certain circunstances.
 - Anti BJ no longer leaves a temp file.
 - Anti BJ now also replaces the GUI get player number with the native one +1 (so it takes less space)
 - String File Fixer now makes sure it is not removing lines inside the strings.

 - The program now tells you how much the file size was reduced.
 - Added a progress bar, new obfuscating methods were too time consuming for me.

 0.3 :
 - Added the Anti BJ obfuscation method, still at beta stage so it can ruin your map, my tests of the method didn't show problems though.

 0.2 :
 - I recently discovered that strings might have a weird behaviur in JASS syntax, and this program wasn't aware of that either, just fixed it, so there aren't bugs with strings that have carriage returns inside.

 0.1 :  (first version)</pre>
</body></html>